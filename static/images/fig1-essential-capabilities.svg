<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="780" height="295" viewBox="0 0 780 295" role="img" shape-rendering="geometricPrecision">

  <!-- ===== Panel (a): Compositional Vectorization ===== -->
  <rect x="0" y="0" width="240" height="225" rx="4" fill="#faf8f5" stroke="#d8d4cf" stroke-width="0.8"/>

  <!-- Outer box: vmap of simulate of -->
  <rect x="22" y="25" width="196" height="155" rx="4" fill="#f0ede8" stroke="#24292e" stroke-width="1.2"/>
  <text x="32" y="46" font-family="'Source Sans 3', sans-serif" font-size="10.5" fill="#24292e">
    <tspan font-family="'Source Code Pro', monospace" font-weight="700">vmap</tspan> of simulate of
  </text>

  <!-- Inner box: vmap of model -->
  <rect x="42" y="60" width="156" height="100" rx="3" fill="#ffffff" stroke="#24292e" stroke-width="1"/>
  <text x="52" y="80" font-family="'Source Sans 3', sans-serif" font-size="10.5" fill="#24292e">
    <tspan font-family="'Source Code Pro', monospace" font-weight="700">vmap</tspan> of model
  </text>

  <!-- Particle dots (4 colored, representing independent computations) -->
  <circle cx="78" cy="118" r="7.5" fill="#c84f8a" opacity="0.9"/>
  <circle cx="100" cy="118" r="7.5" fill="#3f7fcf" opacity="0.9"/>
  <circle cx="122" cy="118" r="7.5" fill="#3fa85f" opacity="0.9"/>
  <circle cx="144" cy="118" r="7.5" fill="#cf7f3f" opacity="0.9"/>

  <!-- Panel title and subtitle -->
  <text x="120" y="248" text-anchor="middle" font-family="'Source Sans 3', sans-serif" font-size="11.5" font-weight="600" fill="#24292e">
    <tspan font-family="'Source Code Pro', monospace" font-weight="700">vmap</tspan> in Modeling <tspan font-style="italic">and</tspan> Inference
  </text>
  <text x="120" y="264" text-anchor="middle" font-family="'Source Sans 3', sans-serif" font-size="9.5" fill="#586069">Vectorization can apply to</text>
  <text x="120" y="277" text-anchor="middle" font-family="'Source Sans 3', sans-serif" font-size="9.5" fill="#586069">models and inference interfaces</text>


  <!-- ===== Panel (b): Vectorized Traces ===== -->
  <rect x="270" y="0" width="240" height="225" rx="4" fill="#faf8f5" stroke="#d8d4cf" stroke-width="0.8"/>

  <!-- Top trace: scalar -->
  <text x="300" y="42" font-family="'Source Sans 3', sans-serif" font-size="11" font-weight="600" fill="#24292e">trace ~ P</text>
  <rect x="290" y="50" width="200" height="28" rx="2" fill="#f0f0f0" stroke="#ccc" stroke-width="0.8"/>
  <text x="300" y="69" font-family="'Source Code Pro', monospace" font-size="9.5" fill="#333">{"a": f32[], "b": f32[]}</text>

  <!-- Down arrow -->
  <line x1="390" y1="88" x2="390" y2="118" stroke="#888" stroke-width="1.2"/>
  <polygon points="386,113 390,122 394,113" fill="#888"/>

  <!-- Bottom trace: vectorized -->
  <text x="300" y="142" font-family="'Source Sans 3', sans-serif" font-size="11" font-weight="600" fill="#0366d6">trace ~ vmap{P}</text>
  <rect x="290" y="150" width="200" height="28" rx="2" fill="#e8f0fe" stroke="#0366d6" stroke-width="1"/>
  <text x="300" y="169" font-family="'Source Code Pro', monospace" font-size="9.5" fill="#0366d6">{"a": f32[N], "b": f32[N]}</text>

  <!-- Panel title and subtitle -->
  <text x="390" y="248" text-anchor="middle" font-family="'Source Sans 3', sans-serif" font-size="11.5" font-weight="600" fill="#24292e">Vectorized Traces</text>
  <text x="390" y="264" text-anchor="middle" font-family="'Source Sans 3', sans-serif" font-size="9.5" fill="#586069">Traces are automatically</text>
  <text x="390" y="277" text-anchor="middle" font-family="'Source Sans 3', sans-serif" font-size="9.5" fill="#586069">structs-of-arrays</text>


  <!-- ===== Panel (c): Stochastic Branching ===== -->
  <rect x="540" y="0" width="240" height="225" rx="4" fill="#faf8f5" stroke="#d8d4cf" stroke-width="0.8"/>

  <!-- Start node (green circle) -->
  <circle cx="660" cy="30" r="8" fill="#28a745" stroke="#22863a" stroke-width="1.5"/>

  <!-- Arrow down to diamond -->
  <line x1="660" y1="38" x2="660" y2="65" stroke="#24292e" stroke-width="1.2"/>

  <!-- Diamond decision node -->
  <polygon points="660,65 697,105 660,145 623,105" fill="#fff5c2" stroke="#c9a227" stroke-width="1.5"/>
  <text x="660" y="110" text-anchor="middle" font-family="'Source Sans 3', sans-serif" font-size="14" font-weight="600" font-style="italic" fill="#735c0f">X</text>

  <!-- Left branch -->
  <line x1="640" y1="128" x2="600" y2="188" stroke="#24292e" stroke-width="1.2"/>
  <text x="606" y="153" font-family="'Source Sans 3', sans-serif" font-size="11" font-style="italic" fill="#586069">p</text>

  <!-- Right branch -->
  <line x1="680" y1="128" x2="720" y2="188" stroke="#24292e" stroke-width="1.2"/>
  <text x="704" y="153" font-family="'Source Sans 3', sans-serif" font-size="11" font-style="italic" fill="#586069">1&#x2212;p</text>

  <!-- End nodes (downward arrowheads) -->
  <polygon points="596,188 600,200 604,188" fill="#24292e"/>
  <polygon points="716,188 720,200 724,188" fill="#24292e"/>

  <!-- Panel title and subtitle -->
  <text x="660" y="248" text-anchor="middle" font-family="'Source Sans 3', sans-serif" font-size="11.5" font-weight="600" fill="#24292e">Stochastic Branching</text>
  <text x="660" y="264" text-anchor="middle" font-family="'Source Sans 3', sans-serif" font-size="9.5" fill="#586069">Vectorization supports stochastic</text>
  <text x="660" y="277" text-anchor="middle" font-family="'Source Sans 3', sans-serif" font-size="9.5" fill="#586069">branching on random values</text>

</svg>
